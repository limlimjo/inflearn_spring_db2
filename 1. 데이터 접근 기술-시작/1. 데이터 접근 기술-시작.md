## 데이터 접근 기술 - 시작

### 데이터 접근 기술 진행 방식 소개

1. SQLMapper

- 주요 기능

  : 개발자는 SQL만 작성하면 해당 SQL의 결과를 객체로 편리하게 매핑해줌

  : JDBC를 직접 사용할 때 발생하는 여러가지 중복을 제거해주고 그외 편리한 기능을 제공함

- 종류

  : JdbcTemplate

  : MyBatis

2. ORM 관련 기술

- 주요 기능

  : JPA를 사용하면 기본적인 SQL은 JPA가 대신 작성하고 처리해줌

  : 개발자는 저장하고 싶은 객체를 마치 자바 컬렉션에 저장하고 조회하듯이 사용하면 ORM 기술이 DB에 해당 객체를 저장하고 조회해줌

  : JPA는 자바 진영의 ORM 표준이고, Hibernate는 JPA에서 가장 많이 사용하는 구현체임. 자바에서 ORM을 사용할 때는 JPA 인터페이스를 사용하고, 그 구현체로 하이버네이트를 사용한다고 생각하면 됨

  : 스프링 데이터 JPA, Querydsl은 JPA를 더 편리하게 사용할 수 있게 도와주는 프로젝트임. 실무에서는 JPA를 사용하면 이 프로젝트도 꼭 함께 사용하는 것이 좋음!

- 종류

  : JPA, Hibernate

  : 스프링 데이터 JPA

  : Querydsl

---

### 프로젝트 설정과 메모리 저장소

- 프로젝트 설정 순서

1. itemservice-db-start의 폴더 이름을 itemservice-db로 변경
2. 프로젝트 임포트
3. File → Open → 해당 프로젝트의 build.gradle 선택
4. ItemServiceApplication.main()을 실행해서 프로젝트가 정상 수행되는지 확인

- 위 프로젝트에서 메모리가 아닌 데이터 접근 기술들을 하나씩 적용해가면서, 각각의 데이터 접근 기술들을 어떻게 사용하는지, 장단점은 무엇인지 코드로 이해하고 학습하기

---

### 프로젝트 구조 설명1 - 기본

- 프로젝트 설정

- 도메인 분석

- 리포지토리 분석

  → DTO (Data Transfer Object)

    : 기능은 없고 데이터를 전달만 하는 용도로 사용되는 객체를 뜻함

    : 객체 이름에 DTO를 꼭 붙여야 하는 것은 아님

    : DTO의 위치는 DTO를 제공하는 마지막 단이 어디냐를 생각하면 됨<br/>
      (즉, 최종 호출하는 곳에 있는게 맞음)

- 서비스 분석

  → 강의 프로젝트에서는 서비스의 구현체를 쉽게 변경하기 위해 인터페이스를 사용했으나 실제로 서비스는 구현체를 변경할 일이 많지는 않기 때문에 사실 서비스에 인터페이스를 잘 도입하지는 않음

- 컨트롤러 분석

---

### 프로젝트 구조 설명2 - 설정

- 스프링 부트 설정 분석

  → `@EventListener(ApplicationReadyEvent.class)`

    : 스프링 컨테이너가 완전히 초기화를 다 끝내고, 실행 준비가 되었을 때 발생하는 이벤트임

    : 참고로 이 기능 대신 `@PostConstruct`를 사용할 경우 AOP 같은 부분이 아직 다 처리되지 않은 시점에 호출될 수 있기 때문에, 간혹 문제가 발생할 수 있음

    : `@EventListener(ApplicationReadyEvent.class)`는 AOP를 포함한 스프링 컨테이너가 완전히 초기화 된 이후에 호출되기 때문에 이런 문제가 발생하지 않음

- 프로필

  → 스프링은 로딩 시점에 application.properties의 spring.profiles.active 속성을 읽어서 프로필로 사용함

  → 프로필은 로컬(나의 PC), 운영 환경, 테스트 실행 등등 다양한 환경에 따라서 다른 설정을 할 때 사용하는 정보임

---

### 프로젝트 구조 설명3 - 테스트

- `@AfterEach`

  → 각각의 테스트의 실행이 끝나는 시점에 호출됨

---

### 데이터베이스 테이블 생성

- `generated by default as identity`

  → identity 전략이라고 하는데, 기본 키 생성을 데이터베이스에 위임하는 방법임

  → MySQL의 Auto Increment와 같은 방법임

  → 여기서 PK로 사용되는 id는 개발자가 직접 지정하는 것이 아니라 비워두고 저장하면 됨. 그러면 데이터베이스가 순서대로 증가하는 값을 사용해서 넣어줌

- 권장하는 식별자 선택 전략

  → 데이터베이스 기본 키는 다음 3가지 조건을 모두 만족해야 함

  1. `null` 값은 허용하지 않음
  2. 유일해야 함
  3. 변해선 안 됨

- 테이블의 기본 키를 선택하는 전략은 크게 2가지가 있음

1. `자연 키(natural key)`

    → 비즈니스에 의미가 있는 키

    → 예: 주민등록번호, 이메일, 전화번호

1. `대리 키(surrogate key)`

    → 비즈니스와 관련 없는 임의로 만들어진 키, 대체 키로도 불림

    → 예: 오라클 시퀀스, auto_increment, identity, 키생성 테이블 사용

- 자연 키보다는 대리 키를 권장함

---

### 정리 및 회고

- 이번 강의에서는 데이터 접근 기술 방식에 대해 간략한 설명과 더불어 설정된 프로젝트의 구조에 대해 정리하였다.

- 이번 강의를 들으면서 3가지 새로운 부분을 알게 되었다. 첫 번째로 `@EventListener(ApplicationReadyEvent.class)`, 두 번째로 프로필, 세 번째로 자연 키와 대리 키이다.

- `@PostConstruct`은 초기에 데이터를 세팅할 때 사용해본 적이 있는데 `@EventListener(ApplicationReadyEvent.class)`은 처음 알았다.<br/>
   두 개는 유사한 기능을 하나 차이점이 있다는 것도 이번 강의를 통해서 처음 알게된 지식이다.

- 프로필 부분은 소스 코드에서 본 적이 있으나 정확히 어떤 역할을 하는지 몰랐었는데 이번 강의를 통해 알게 되었다.

- 지연 키와 대리 키 같은 경우 이러한 키들이 PK 역할을 한다는 것은 알고 있었지만 정확히 이런 용어로 쓰이는지는 처음 알았다.<br/>
  또한, 왜 자연 키보다 대리 키를 권장하는지도 알게 되는 계기가 되었다.