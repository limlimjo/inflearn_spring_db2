## 데이터 접근 기술 - 활용 방안

### 스프링 데이터 JPA 예제와 트레이드 오프

1. `(앞에서 본 스프링 데이터 JPA 예제)`

- `JpaItemRepositoryV2`가 어댑터 역할을 해줘 `ItemService`가 사용하는 `ItemRepository` 인터페이스를 그대로 유지할 수 있었고 클라이언트인 `ItemService`의 코드를 변경하지 않아도 될 수 있었음.

- DI, OCP 원칙을 지킬 수 있다는 좋은 점은 있으나 중간에 어댑터가 들어가면서 전체 구조가 너무 복잡해지고 어댑터 코드와 실제 코드까지 함께 유지보수 해야하는 어려움이 발생함.

2. `트레이드 오프`

- 첫 번째 DI, OCP를 지키기 위해 어댑터를 도입하고, 더 많은 코드를 유지함. (구조의 안정성)

- 두 번째 어댑터를 제거하고 구조를 단순하게 가져가지만 DI, OCP를 포기하고 `ItemService` 코드를 직접 변경함. (단순한 구조와 개발의 편리성)

- 둘 중에 정답은 없음. 진행하는 프로젝트의 상황을 보며 적절한 선택을 하는게 좋음.

---

### 실용적인 구조

- 스프링 데이터 JPA의 기능은 최대한 살리면서 QueryDSL도 편리하게 사용할 수 있는 구조 만들기

    ```
    ItemService -> ItemRepository <<interface>>
                -> ItemQueryRepositoryV2
    ```

- 위처럼 분리하면 기본 CRUD와 단순 조회는 스프링 데이터 JPA가 담당하게 하고, 복잡한 쿼리 조회는 Querydsl이 담당하게 할 수 있음

- 관련 코드는 github 참고 (실용적인 구조)

---

### 다양한 데이터 접근 기술 조합

- 어떤 데이터 접근 기술을 선택하는 것이 좋을까?

- 비즈니스 상황과 구성원의 역량에 따라서 결정하는게 맞음

- JPA와 JdbcTemplate 두 기술을 함께 사용하면 트랜잭션 매니저가 달라지는데 이 부분은 어떻게?

- `JpaTransactionManager`는 `DataSourceTransactionManager`가 제공하는 기능도 대부분 제공함.

- JPA라는 기술도 내부에서는 DataSource와 JDBC 커넥션을 사용하기 때문에 JdbcTemplate, MyBatis와 함께 사용할 수 있음.

---

### 정리 및 회고

- 실무에서는 MyBatis를 사용하고 있는데 이 기술을 사용하면서 우리 프로젝트에 적절한가에 대해 고민해본적은 없는 것 같다.

- 이번 강의를 들으면서 새로운 데이터 접근 기술을 배우며 복잡하지 않은 쿼리 조회 같은 거는 스프링 데이터 JPA를 사용하면 반복되는 쿼리문을 작성할 필요가 없겠다는 생각이 들었다.

- 또한 현재 실무 프로젝트에서는 복잡한 쿼리문이 많다보니 MyBatis를 사용하는게 더 적절한 걸로 보인다. 하지만 처음부터 스프링 데이터 JPA로 프로젝트를 진행했다면 복잡한 쿼리문에 대한 부분은 QueryDSL로 처리할 수 있지 않았을까 생각이 든다.

---